<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Motores Input</title>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f9f9f9;
      color: #222;
      margin: 0;
      padding: 2em;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 600px;
    }
    input, select, button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
    }
    button {
      background: #fff;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background: #eee;
    }
    .category {
      margin-top: 1em;
      padding: 0.5em;
      border-bottom: 1px solid #ddd;
    }
    a {
      display: inline-block;
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Add Motor</h2>
    <input id="motorText" placeholder="Enter text..." />
    <input id="motorCategory" placeholder="Enter category..." />
    <button id="saveMotor">Save Motor</button>
    <button id="resetSession">Reset Session</button>
    <h3>All Motors</h3>
    <div id="motorsList"></div>
    <a href="motores_random.html">â†’ Go to Random Selector</a>
  </div>
  <script>
    const ws = new WebSocket('ws://<HOST-IP>:8080');
    const motorText = document.getElementById('motorText');
    const motorCategory = document.getElementById('motorCategory');
    const motorsList = document.getElementById('motorsList');
    const saveMotor = document.getElementById('saveMotor');
    const resetSession = document.getElementById('resetSession');

    function renderMotors(data) {
      motorsList.innerHTML = Object.keys(data).map(cat => `
        <div class="category">
          <h4>${cat}</h4>
          <ul>${data[cat].map(t => `<li>${t}</li>`).join('')}</ul>
        </div>
      `).join('');
    }

    ws.addEventListener('message', event => {
      try {
        const msg = JSON.parse(event.data);
        if (msg.type === 'init' || msg.type === 'update') {
          renderMotors(msg.data || {});
        }
      } catch (err) {
        console.error('Failed to parse message', err);
      }
    });

    saveMotor.addEventListener('click', () => {
      const text = motorText.value.trim();
      const category = motorCategory.value.trim();
      if (!text || !category) {
        return;
      }
      ws.send(JSON.stringify({
        type: 'addMotor',
        category,
        text
      }));
      motorText.value = '';
    });

    resetSession.addEventListener('click', () => {
      ws.send(JSON.stringify({ type: 'reset' }));
    });
  </script>
</body>
</html>
